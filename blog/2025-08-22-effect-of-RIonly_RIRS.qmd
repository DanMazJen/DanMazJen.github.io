---
title: "Why random slopes?"
subtitle: "... and why random intercepts are often not enough"
author: "Daniel S. Mazhari-Jensen"
description: "Using lme4, I show why random slopes is often needed in biomedical research and experiments"
date: 2025-07-23
reading-time: 5 min
file-modified: 2025-07-23
categories: [R, lme4, multilevel regression]
format:
  html:
    toc: true
    code-fold: true
---


Welcome to the website.

Currently, this is a test. The site will expand over the next couple of months.

The content will be small blog-styled pieces of statistical material.

# Multi-level models and why random slopes matter

![](plots/random-slopes-preview.png){.preview-image}

In this post, we'll discuss why random slopes are often of special concern in health science data and biometrics. We will use `lme4` and `ggplot2` to do so. The data set we'll use to demonstrate this comes from ...


```{r}
#| echo: false
library(lme4)
library(ggplot2)
```

## A brief look at the data:

```{r}
str(sleepstudy) # for more info, consult ?lme4::sleepstudy for the lme4 documentation
```

```{r}
sleepstudy |> 
  ggplot(aes(y=Reaction, x=Days)) +
  facet_wrap(~ Subject, ncol=6) +
  geom_point() +
  geom_line() +
  scale_x_continuous(limits=c(0, 9),breaks=c(0:9))
```

## The ANOVA approach (full pooling)

```{r}
anova_approach <- lm(Reaction ~ 1 + Days, sleepstudy)
summary(anova_approach)
```

Here is the model prediction - notice how every participant is assumed to have the same initial value and linear trajectory. This is due to pooling, an assumption from ANOVA.

```{r}
ggplot(sleepstudy, aes(Days, Reaction, group=Subject)) + 
  facet_wrap(~Subject, ncol=6) +
  geom_point() + 
  geom_line(aes(y=fitted(anova_approach)), linetype=2, color = "red") + 
  scale_x_continuous(limits=c(0, 9),breaks=c(0:9))
```

## No pooling - treating every participant as their own experiment...

If we want to be more sensitive to individual variability, we need to allow participants to be modeled more individually. This can be done by computing linear regression for each participant, treating them as individual cases with no overlap.

```{r}
no_pooling <- lmList(Reaction ~ Days | Subject, sleepstudy)
summary(no_pooling)
```

```{r}
ggplot(sleepstudy, aes(Days, Reaction, group=Subject)) + 
  facet_wrap(~Subject, ncol=6) +
  geom_point() + 
  geom_line(aes(y=fitted(no_pooling)), linetype=2, color = "red") + 
  scale_x_continuous(limits=c(0, 9),breaks=c(0:9))
```

## Partial pooling

### With random intercept only:

We can relax the assumption of pooling by allowing each participant to have their own intercept.

```{r}
RI_only <- lmer(Reaction ~ 1 + Days + (1 | Subject), sleepstudy)
summary(RI_only)
```

Note the fixed effect 10.4673 / 0.8042 = `{r} 10.4673 / 0.8042`

```{r}
ggplot(sleepstudy, aes(Days, Reaction, group=Subject)) + 
  facet_wrap(~Subject, ncol=6) +
  geom_point() + 
  geom_line(aes(y=fitted(RI_only)), linetype=2, color = "red") + 
  scale_x_continuous(limits=c(0, 9),breaks=c(0:9))
```

### Now with random intercept, random slope, and correlated random terms

```{r}
RI_RS_corr <- lmer(Reaction ~ 1 + Days + (1 + Days | Subject), sleepstudy)
summary(RI_RS_corr)
```

Note the fixed effect 10.467 / 1.546 = `{r} 10.467 / 1.546`

```{r}
ggplot(sleepstudy, aes(Days, Reaction, group=Subject, colour=Subject)) + 
  facet_wrap(~Subject, ncol=6) +
  geom_point() + 
  geom_line(aes(y=fitted(RI_RS_corr)), linetype=2, color = "red") + 
  scale_x_continuous(limits=c(0, 9),breaks=c(0:9))
```

## Comparing model predictions

```{r}
ggplot(sleepstudy, aes(Days, Reaction, group=Subject)) + 
  facet_wrap(~Subject, ncol=6) +
  geom_point() + 
  geom_line(aes(y=fitted(anova_approach)), linetype=2, color = "red") + 
  geom_line(aes(y=fitted(no_pooling)), linetype=2, color = "green") + 
  geom_line(aes(y=fitted(RI_only)), linetype=2, color = "blue") + 
  geom_line(aes(y=fitted(RI_RS_corr)), linetype=2, color = "black") +
  scale_x_continuous(limits=c(0, 9),breaks=c(0:9))
```

## Conclusions

-   While random intercept models are within the class of linear mixed-effect models, they are often difficult to find use cases for within cognitive neuroscience experiments.
-   While accouting for individual starting differences is a set up from the ANOVA approach, it still assumes no variability between participants.
-   Fitting mass linear models (no pooling) overcomes this problem. However, researchers often aim to generalize and make population-based conclusions. It is therefore not optimal for this use case.
-   Linear mixed-effect models that are modeled appropriately to a specific data set is a great approach (partial-pooling). However, they quickly become tricky to set up when there are multiple predictors, groups, covariates, and especially interactions.
